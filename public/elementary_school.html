<!doctype html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://use.typekit.net/kdc4trt.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.4/css/jquery.dataTables.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
          integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous" />
    <link rel="stylesheet" href="../../static/schools.css" />
    <link rel="stylesheet" href="../../static/search-inside.css">
    <title>{{ school.school }}</title>
</head>

<body>
<div class="search-block">
    <div class="app-search">
        <a href="../../"><img src="../../static/home.png"></a>
        <div class="search-row">
            <input id="fill-box" type="text" placeholder="Search school or district ...">
            <i class="fa fa-search"></i>
        </div>
    </div> <!-- closes app search -->
    <div id="suggestions-list" class="list-items"></div>
</div> <!-- closes search block -->
</div>
<div class="container">
    <div id="title">
        <h1>{{ school.school }}</h1>
        <h3>{{ school.district }}</h2>
            <h4>{{ school.street|title }}, {{ school.city|title }} </h2>
                <h4>{{ school.total_actively_enrolled_students|int }} students, {{ school.teacher_count|int }} teachers</h2>
    </div>
    <div class="row">
        <div class="col-12 col-md-12 graphic">
            <div class="graphic-style">
                <h5>Academic Performance</h5>
                <div class="row">
                    <div class="col-sm-4">
                        <canvas id="chart-reading"></canvas>
                    </div>
                    <div class="col-sm-4">
                        <canvas id="chart-math"></canvas>
                    </div>
                    <div class="col-sm-4">
                        <canvas id="chart-science"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-12 graphic">
            <div class="graphic-style">
                <h5>Demographics</h5>
                <div class="row">
                    <div class="col-sm-4">
                        <canvas id="chart-poverty"></canvas>
                    </div>
                    <div class="col-sm-4">
                        <canvas id="chart-disabilities"></canvas>
                    </div>
                    <div class="col-sm-4">
                        <canvas id="chart-english-learners"></canvas>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <canvas id="chart-race"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4 graphic">
            <div class="graphic-style">
                <div id="chart-harrassment"></div>
            </div>
        </div>
        <div class="col-md-4 graphic">
            <div class="graphic-style">
                <div id="chart-teacherpay"></div>
            </div>
        </div>
        <div class="col-md-4 graphic">
            <div class="graphic-style">
                <div id="chart-childsafe"></div>
            </div>
        </div>
        <div class="col-12 col-md-4 graphic">
            <div class="graphic-style">
                <div id="chart-teachersafe"></div>
            </div>
        </div>
        <div class="col-12 col-md-4 graphic">
            <div class="graphic-style">
                <div id="chart-violent"></div>
            </div>
        </div>
        <div class="col-12 col-md-4 graphic">
            <div class="graphic-style">
                <div id="chart-nonviolent"></div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js"></script>

<!-- load d3 -->
<script src="https://d3js.org/d3.v7.min.js"></script>

<!-- chart.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.8.0/chart.js" integrity="sha512-5m2r+g00HDHnhXQDbRLAfZBwPpPCaK+wPLV6lm8VQ+09ilGdHfXV7IVyKPkLOTfi4vTTUVJnz7ELs7cA87/GMA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>

<!-- fuse js -->
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.1"></script>

<!-- jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<script src="../../static/search.js"></script>

<!-- JavaScript  -->
<script>

    Chart.register(ChartDataLabels);

    const name = `{{ school.school }}`

    new Chart(
        document.getElementById('chart-reading'), {
            type: 'bar',
            data: {
                labels: [
                    'Students with Positive Reading Score'
                ],
                datasets: [{
                    label: name,
                    backgroundColor: 'rgb(255, 99, 132)',
                    borderColor: 'rgb(255, 99, 132)',
                    data: [`{{school.e_pct_me}}` === 'NA' ? 0 : `{{school.e_pct_me}}`],
                    barPercentage: 1.0,
                    categoryPercentage: 0.6,
                },
                    {
                        label: 'District Average',
                        backgroundColor: 'rgb(63,183,73)',
                        borderColor: 'rgb(63,183,73)',
                        data: [`{{district.e_pct_me}}` === 'NA' ? 0 : `{{district.e_pct_me}}`],
                        barPercentage: 1.0,
                        categoryPercentage: 0.6,
                    },
                    {
                        label: 'State Average',
                        backgroundColor: 'rgb(30,144,255)',
                        borderColor: 'rgb(30,144,255)',
                        data: [`{{state_average.e_pct_me}}` === 'NA' ? 0 : `{{state_average.e_pct_me}}`],
                        barPercentage: 1.0,
                        categoryPercentage: 0.6,
                    }]
            },
            options: {
                maintainAspectRatio: false,
                scales: {
                    y: {
                        max: 100,
                        ticks: {
                            callback: function(value, index, ticks) {
                                return `${value}%`
                            }
                        },
                    },
                },
                plugins: {
                    datalabels: {
                        formatter: (value, ctx) => {
                            if (value !== 0) {
                                return Math.round(value) + '%';
                            } else {
                                return 'N/A'
                            }
                        },
                        anchor: 'end',
                        align: (value, ctx) => {
                            if (value.dataset.data[0] > 30) {
                                return 'bottom'
                            }
                            else {
                                return 'top'
                            }
                        },
                        font: {
                            weight: 'bold'
                        }
                    },
                    tooltips: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + '%';
                            },
                        }
                    }
                }
            }
        }
    );

    new Chart(
        document.getElementById('chart-math'), {
            type: 'bar',
            data: {
                labels: [
                    'Students with Positive Math Score'
                ],
                datasets: [{
                    label: name,
                    backgroundColor: 'rgb(255, 99, 132)',
                    borderColor: 'rgb(255, 99, 132)',
                    data: [`{{school.m_pct_me}}` === 'NA' ? 0 : `{{school.m_pct_me}}`],
                    barPercentage: 1.0,
                    categoryPercentage: 0.6,
                },
                    {
                        label: 'District Average',
                        backgroundColor: 'rgb(63,183,73)',
                        borderColor: 'rgb(63,183,73)',
                        data: [`{{district.m_pct_me}}` === 'NA' ? 0 : `{{district.m_pct_me}}`],
                        barPercentage: 1.0,
                        categoryPercentage: 0.6,
                    },
                    {
                        label: 'State Average',
                        backgroundColor: 'rgb(30,144,255)',
                        borderColor: 'rgb(30,144,255)',
                        data: [`{{state_average.m_pct_me}}` === 'NA' ? 0 : `{{state_average.m_pct_me}}`],
                        barPercentage: 1.0,
                        categoryPercentage: 0.6,
                    }]
            },
            options: {
                maintainAspectRatio: false,
                scales: {
                    y: {
                        max: 100,
                        ticks: {
                            callback: function(value, index, ticks) {
                                return `${value}%`
                            }
                        },
                    },
                },
                plugins: {
                    datalabels: {
                        formatter: (value, ctx) => {
                            if (value !== 0) {
                                return Math.round(value) + '%';
                            } else {
                                return 'N/A'
                            }
                        },
                        anchor: 'end',
                        align: (value, ctx) => {
                            if (value.dataset.data[0] > 30) {
                                return 'bottom'
                            }
                            else {
                                return 'top'
                            }
                        },
                        font: {
                            weight: 'bold'
                        }
                    },
                    legend: {
                        display: false
                    },
                    tooltips: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + '%';
                            },
                        }
                    }
                }
            }
        }
    );

    new Chart(
        document.getElementById('chart-science'), {
            type: 'bar',
            data: {
                labels: [
                    'Students with Positive Science Score'
                ],
                datasets: [{
                    label: name,
                    backgroundColor: 'rgb(255, 99, 132)',
                    borderColor: 'rgb(255, 99, 132)',
                    data: [`{{school.sc_pct_me}}` === 'NA' ? 0 : `{{school.sc_pct_me}}`],
                    barPercentage: 1.0,
                    categoryPercentage: 0.6,
                },
                    {
                        label: 'District Average',
                        backgroundColor: 'rgb(63,183,73)',
                        borderColor: 'rgb(63,183,73)',
                        data: [`{{district.sc_pct_me}}` === 'NA' ? 0 : `{{district.sc_pct_me}}`],
                        barPercentage: 1.0,
                        categoryPercentage: 0.6,
                    },
                    {
                        label: 'State Average',
                        backgroundColor: 'rgb(30,144,255)',
                        borderColor: 'rgb(30,144,255)',
                        data: [`{{state_average.sc_pct_me}}` === 'NA' ? 0 : `{{state_average.sc_pct_me}}`],
                        barPercentage: 1.0,
                        categoryPercentage: 0.6,
                    }]
            },
            options: {
                maintainAspectRatio: false,
                scales: {
                    y: {
                        max: 100,
                        ticks: {
                            callback: function(value, index, ticks) {
                                return `${value}%`
                            }
                        },
                    },
                },
                plugins: {
                    datalabels: {
                        formatter: (value, ctx) => {
                            if (value !== 0) {
                                return Math.round(value) + '%';
                            } else {
                                return 'N/A'
                            }
                        },
                        anchor: 'end',
                        align: (value, ctx) => {
                            if (value.dataset.data[0] > 30) {
                                return 'bottom'
                            }
                            else {
                                return 'top'
                            }
                        },
                        font: {
                            weight: 'bold'
                        }
                    },
                    legend: {
                        display: false
                    },
                    tooltips: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + '%';
                            },
                        }
                    }
                }
            }
        }
    );

    new Chart(
        document.getElementById('chart-race'), {
            type: 'bar',
            data: {
                labels: [
                    'White',
                    'Black',
                    'Other'
                ],
                datasets: [{
                    label: name,
                    backgroundColor: 'rgb(255, 99, 132)',
                    borderColor: 'rgb(255, 99, 132)',
                    data: [
                        `{{school.percent_white}}` === 'NA' ? 0 : `{{school.percent_white}}`,
                        `{{school.percent_black_aa}}` === 'NA' ? 0 : `{{school.percent_black_aa}}`,
                        `{{school.percent_all_other_races}}` === 'NA' ? 0 : `{{school.percent_all_other_races}}`,
                    ],
                    barPercentage: 1.0,
                    categoryPercentage: 0.6,
                },
                    {
                        label: 'District Average',
                        backgroundColor: 'rgb(63,183,73)',
                        borderColor: 'rgb(63,183,73)',
                        data: [
                            `{{district.percent_white}}` === 'NA' ? 0 : `{{district.percent_white}}`,
                            `{{district.percent_black_aa}}` === 'NA' ? 0 : `{{district.percent_black_aa}}`,
                            `{{district.percent_all_other_races}}` === 'NA' ? 0 : `{{district.percent_all_other_races}}`,
                        ],
                        barPercentage: 1.0,
                        categoryPercentage: 0.6,
                    },
                    {
                        label: 'State Average',
                        backgroundColor: 'rgb(30,144,255)',
                        borderColor: 'rgb(30,144,255)',
                        data: [
                            `{{state_average.percent_white}}` === 'NA' ? 0 : `{{state_average.percent_white}}`,
                            `{{state_average.percent_black_aa}}` === 'NA' ? 0 : `{{state_average.percent_black_aa}}`,
                            `{{state_average.percent_all_other_races}}` === 'NA' ? 0 : `{{state_average.percent_all_other_races}}`,
                        ],
                        barPercentage: 1.0,
                        categoryPercentage: 0.6,
                    },
                ]},
            options: {
                maintainAspectRatio: false,
                scales: {
                    y: {
                        max: 100,
                        ticks: {
                            callback: function(value, index, ticks) {
                                return `${value}%`
                            }
                        },
                    },
                },
                plugins: {
                    datalabels: {
                        formatter: (value, ctx) => {
                            if (value !== 0) {
                                return Math.round(value) + '%';
                            } else {
                                return 'N/A'
                            }
                        },
                        anchor: 'end',
                        align: (value, ctx) => {
                            if (value.dataset.data[value.dataIndex] > 30) {
                                return 'bottom'
                            }
                            else {
                                return 'top'
                            }
                        },
                        font: (context) => {
                            var avgSize = Math.round((context.chart.height + context.chart.width) / 2);
                            var size = Math.round(avgSize / 32);
                            size = size > 12 ? 12 : size + 1;
                            return {
                                size,
                                weight: 'bold'
                            }
                        }
                    },
                    tooltips: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + '%';
                            },
                        }
                    },
                    legend: {
                        display: false
                    }
                }
            }
        }
    );

    new Chart(
        document.getElementById('chart-poverty'), {
            type: 'bar',
            data: {
                labels: [
                    'Students in Poverty',
                ],
                datasets: [{
                    label: name,
                    backgroundColor: 'rgb(255, 99, 132)',
                    borderColor: 'rgb(255, 99, 132)',
                    data: [`{{school.studentsin_poverty_pct_curr_yr}}` === 'NA' ? 0 : `{{school.studentsin_poverty_pct_curr_yr}}`],
                    barPercentage: 1.0,
                    categoryPercentage: 0.6,
                },
                    {
                        label: 'District Average',
                        backgroundColor: 'rgb(63,183,73)',
                        borderColor: 'rgb(63,183,73)',
                        data: [`{{district.studentsin_poverty_pct_curr_yr}}` === 'NA' ? 0 : `{{district.studentsin_poverty_pct_curr_yr}}`],
                        barPercentage: 1.0,
                        categoryPercentage: 0.6,
                    },
                    {
                        label: 'State Average',
                        backgroundColor: 'rgb(30,144,255)',
                        borderColor: 'rgb(30,144,255)',
                        data: [`{{state_average.studentsin_poverty_pct_curr_yr}}` === 'NA' ? 0 : `{{state_average.studentsin_poverty_pct_curr_yr}}`],
                        barPercentage: 1.0,
                        categoryPercentage: 0.6,
                    }]
            },
            options: {
                legend: {
                    display: false,
                },
                maintainAspectRatio: false,
                scales: {
                    y: {
                        max: 100,
                        ticks: {
                            callback: function(value, index, ticks) {
                                return `${value}%`
                            }
                        },
                        title: {
                            display: false,
                            text: 'Percentage of Students with Satisfactory Scores'
                        }
                    }
                },
                plugins: {
                    datalabels: {
                        formatter: (value, ctx) => {
                            if (value !== 0) {
                                return Math.round(value) + '%';
                            } else {
                                return 'N/A'
                            }
                        },
                        anchor: 'end',
                        align: (value, ctx) => {
                            if (value.dataset.data[0] > 30) {
                                return 'bottom'
                            }
                            else {
                                return 'top'
                            }
                        },
                        font: {
                            weight: 'bold'
                        }
                    },
                    tooltips: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + '%';
                            },
                        }
                    },
                    legend: {
                        display: true
                    }
                }
            }
        }
    );

    new Chart(
        document.getElementById('chart-disabilities'), {
            type: 'bar',
            data: {
                labels: [
                    'Students with Disabilities',
                ],
                datasets: [{
                    label: name,
                    backgroundColor: 'rgb(255, 99, 132)',
                    borderColor: 'rgb(255, 99, 132)',
                    data: [`{{school.pct_disabilities}}` === 'NA' ? 0 : `{{school.pct_disabilities}}`],
                    barPercentage: 1.0,
                    categoryPercentage: 0.6,
                },
                    {
                        label: 'District Average',
                        backgroundColor: 'rgb(63,183,73)',
                        borderColor: 'rgb(63,183,73)',
                        data: [`{{district.pct_disabilities}}` === 'NA' ? 0 : `{{district.pct_disabilities}}`],
                        barPercentage: 1.0,
                        categoryPercentage: 0.6,
                    },
                    {
                        label: 'State Average',
                        backgroundColor: 'rgb(30,144,255)',
                        borderColor: 'rgb(30,144,255)',
                        data: [`{{state_average.pct_disabilities}}` === 'NA' ? 0 : `{{state_average.pct_disabilities}}`],
                        barPercentage: 1.0,
                        categoryPercentage: 0.6,
                    }]
            },
            options: {
                legend: {
                    display: false,
                },
                maintainAspectRatio: false,
                scales: {
                    y: {
                        max: 100,
                        ticks: {
                            callback: function(value, index, ticks) {
                                return `${value}%`
                            }
                        },
                    }
                },
                plugins: {
                    datalabels: {
                        formatter: (value, ctx) => {
                            if (value !== 0) {
                                return Math.round(value) + '%';
                            } else {
                                return 'N/A'
                            }
                        },
                        anchor: 'end',
                        align: (value, ctx) => {
                            if (value.dataset.data[0] > 30) {
                                return 'bottom'
                            }
                            else {
                                return 'top'
                            }
                        },
                        font: {
                            weight: 'bold'
                        }
                    },
                    legend: {
                        display: false,
                    },
                    tooltips: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + '%';
                            },
                        }
                    }
                }
            }
        }
    );

    new Chart(
        document.getElementById('chart-english-learners'), {
            type: 'bar',
            data: {
                labels: [
                    'English Language Learning Students',
                ],
                datasets: [{
                    label: name,
                    backgroundColor: 'rgb(255, 99, 132)',
                    borderColor: 'rgb(255, 99, 132)',
                    data: [`{{school.pct_el}}` === 'NA' ? 0 : `{{school.pct_el}}`],
                    barPercentage: 1.0,
                    categoryPercentage: 0.6,
                },
                    {
                        label: 'District Average',
                        backgroundColor: 'rgb(63,183,73)',
                        borderColor: 'rgb(63,183,73)',
                        data: [`{{district.pct_el}}` === 'NA' ? 0 : `{{district.pct_el}}`],
                        barPercentage: 1.0,
                        categoryPercentage: 0.6,
                    },
                    {
                        label: 'State Average',
                        backgroundColor: 'rgb(30,144,255)',
                        borderColor: 'rgb(30,144,255)',
                        data: [`{{state_average.pct_el}}` === 'NA' ? 0 : `{{state_average.pct_el}}`],
                        barPercentage: 1.0,
                        categoryPercentage: 0.6,
                    }]
            },
            options: {
                legend: {
                    display: false,
                },
                maintainAspectRatio: false,
                scales: {
                    y: {
                        max: 100,
                        ticks: {
                            callback: function(value, index, ticks) {
                                return `${value}%`
                            }
                        },
                    }
                },
                plugins: {
                    datalabels: {
                        formatter: (value, ctx) => {
                            if (value !== 0) {
                                return Math.round(value) + '%';
                            } else {
                                return 'N/A'
                            }
                        },
                        anchor: 'end',
                        align: (value, ctx) => {
                            if (value.dataset.data[0] > 30) {
                                return 'bottom'
                            }
                            else {
                                return 'top'
                            }
                        },
                        font: {
                            weight: 'bold'
                        }
                    },
                    legend: {
                        display: false,
                    },
                    tooltips: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + '%';
                            },
                        }
                    }
                }
            }
        }
    );

    function drawStat(graphic,data){
        var chartWidth = $(graphic).width()

        var margin = {
            top: 0,
            right: 0,
            bottom: 25,
            left: 0
        }

        const div = d3.select(graphic)
            .append("div")
            .style("width", `100%`)
            .style("height", `100%`)
            .style("text-align","center")
            .style("margin", "auto")
            .selectAll(null)
            .data(data)
            .enter()


        const num = div
            .append("h1")
            .text(function (d) {
                return `${d.value}`
            })
            //.style("font-size","84px")
            .style("color","#82C566")
            .style("font-family","miller-headline")
            .style("font-weight","700")

        const text = div
            .append("h5")
            .text(function (d) {
                return d.label
            })

    }

    function formatComma(float){
        num = Math.round(float)
        return num.toLocaleString("en-US")
    }

    const dataTeacherpayStat = [
        { label: 'Average teacher pay', value: `${'{{ district.tchsalary_avg_curr }}' === 'NA' ? 'N/A' : '$' + formatComma({{ district.tchsalary_avg_curr_yr }})}` }
    ]

    const dataChildsafeStat = [
        { label: 'Parents who agree "my child feels safe at school"', value: `${'{{ district.par_child_feels_safe }}' === 'NA' ? 'N/A' : formatComma({{ district.par_child_feels_safe }}) + '%'}` }
    ]

    const dataTeachersafeStat = [
        { label: 'Teachers who agree "I feel safe at my school"', value: `${'{{ district.tch_i_feel_safe }}' === 'NA' ? 'N/A' : formatComma({{ district.tch_i_feel_safe }}) + '%'}` }
    ]

    const dataViolentassaultsStat = [
        { label: 'Number of violent assaults', value: `${'{{ district.ocr_violent_all }}' === 'NA' ? 'N/A' : formatComma({{ district.ocr_violent_all }})}` }
    ]

    const dataNonviolentassaultsStat = [
        { label: 'Number of nonviolent assaults', value: `${'{{ district.ocr_nonviolent_all }}' === 'NA' ? 'N/A' : formatComma({{ district.ocr_nonviolent_all }})}` }
    ]

    const dataHarrassmentStat = [
        { label: 'Number of incidents of bullying or harrassment', value: `${'{{ district.ocr_bully_harass }}' === 'NA' ? 'N/A' : formatComma({{ district.ocr_bully_harass }})}` }
    ]

    searchApp("school")

    drawStat("#chart-teacherpay",dataTeacherpayStat)
    drawStat("#chart-childsafe",dataChildsafeStat)
    drawStat("#chart-teachersafe",dataTeachersafeStat)
    drawStat("#chart-violent",dataViolentassaultsStat)
    drawStat("#chart-nonviolent",dataNonviolentassaultsStat)
    drawStat("#chart-harrassment",dataHarrassmentStat)

</script>

</body>

</html>
